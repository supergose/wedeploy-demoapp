<!DOCTYPE html>
<html lang="it">
<head>
	<meta charset="UTF-8">
	<meta content="minimum-scale=1.0, width=device-width" name="viewport">
	<title>Demo API</title>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
	<style>
        body {
            background: #0e141a;
            font-family: 'Open Sans', sans-serif;
        }
        .container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            width: 90%;
        }
        h1 {
            font-size: 40px;
            font-weight: 700;
            color: #00d46a;
            margin: 0;
        }
        h2 {
            font-weight: 300;
            color: rgba(255, 255, 255, 0.9);
            margin: 0;
            font-size: 16px;
        }
        button {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .btn {
            display: inline-block;
            font-weight: normal;
            text-align: center;
            white-space: nowrap;
            vertical-align: middle;
            user-select: none;
            border: 1px solid transparent;
            padding: 0.5rem 0.75rem;
            font-size: 1rem;
            line-height: 1.25;
            border-radius: 0.25rem;
            transition: all 0.15s ease-in-out;
        }

        .btn:focus, .btn:hover {
            text-decoration: none;
        }

        .btn-success {
        color: #fff;
        background-color: #28a745;
        border-color: #28a745;
        }

        .btn-success:hover {
        color: #fff;
        background-color: #218838;
        border-color: #1e7e34;
        }

        .btn-success:focus, .btn-success.focus {
        box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.5);
        }

        @media screen and (min-width: 680px) {
            h1 {
                font-size: 72px;
            }
            h2 {
                font-size: 24px;
            }
        }
	</style>
</head>
<body>
	<div class="container">
		<h2>Oauth redirect ...</h2>
	</div>

    <button id="button-api" class="btn btn-success">Call API</button>

    <script>
        var getUrlParameter = function getUrlParameter(sParam) {
            var sPageURL = decodeURIComponent(window.location.search.substring(1)),
                sURLVariables = sPageURL.split('&'),
                sParameterName,
                i;

            for (i = 0; i < sURLVariables.length; i++) {
                sParameterName = sURLVariables[i].split('=');

                if (sParameterName[0] === sParam) {
                    return sParameterName[1] === undefined ? true : sParameterName[1];
                }
            }
        };

        //get authorization token
        var url = window.location.hash;
        var t = url.substring(url.indexOf('#')+1);
        token = (t.split("&")[0]).split("=")[1];
        console.log("SECURITY TOKEN", token);

        //get access token
        var accessTokenURL = "http://zanatta-test.apigee.net/jwt-bearer/oauth/accesstoken";
        var accessToken = "";
        var params = {
            "grant_type": "urn:ietf:params:oauth:grant-type:jwt-bearer",
            "assertion": token
        };

        $.ajax({
            url: accessTokenURL,
            type: 'POST',
            params: params,
            success: function(data, status) {
                accessToken = data.access_token;
                console.log("ACCESS TOKEN", accessToken)
            },
            beforeSend: function(xhr, settings) { xhr.setRequestHeader('Contet-type', 'application/x-www-form-urlencoded'); } 
        });


        //API CALL
        var apiendpoint = "http://zanatta-test.apigee.net/hello";

        $("#button-api").click(function(){
            $.ajax({
                url: apiendpoint,
                type: 'GET',
                success: function(data, status) {
                    return console.log("RESPONSE API", data);
                },
                beforeSend: function(xhr, settings) { xhr.setRequestHeader('Authorization', "Bearer " + accessToken); } 
            });
        });

    </script>
</body>
</html>