<!DOCTYPE html>
<html lang="it">
<head>
	<meta charset="UTF-8">
	<meta content="minimum-scale=1.0, width=device-width" name="viewport">
	<title>Demo API</title>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
	<style>
        body {
            background: #0e141a;
            font-family: 'Open Sans', sans-serif;
        }
        .container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            width: 90%;
        }
        h1 {
            font-size: 40px;
            font-weight: 700;
            color: #00d46a;
            margin: 0;
        }
        h2 {
            font-weight: 300;
            color: rgba(255, 255, 255, 0.9);
            margin: 0;
            font-size: 16px;
        }
        button {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        @media screen and (min-width: 680px) {
            h1 {
                font-size: 72px;
            }
            h2 {
                font-size: 24px;
            }
        }
	</style>
</head>
<body>
	<div class="container">
		<h2>Oauth redirect ...</h2>
	</div>

    <button id="button-api" class="btn btn-success">Call API</button>

    <script>


        var getUrlParameter = function getUrlParameter(sParam) {
            var sPageURL = decodeURIComponent(window.location.search.substring(1)),
                sURLVariables = sPageURL.split('&'),
                sParameterName,
                i;

            for (i = 0; i < sURLVariables.length; i++) {
                sParameterName = sURLVariables[i].split('=');

                if (sParameterName[0] === sParam) {
                    return sParameterName[1] === undefined ? true : sParameterName[1];
                }
            }
        };

        var code = getUrlParameter('code');

        var url = "https://www.googleapis.com/oauth2/v4/token";
        var params = {
            "code": code,
            "client_id": "885112234544-5evc06p7fpcek79l3rioc3c73aegs557.apps.googleusercontent.com",
            "client_secret": "JZH3EcsN8dN-376usp9AUIqT",
            "redirect_uri": "https://web-supergose.wedeploy.io/oauth.html",
            "grant_type": "authorization_code"
        };

        var token = "Bearer ";
        //var apiendpoint = "https://bmed.cloud.tyk.io/listamovimenti/hello?name=BMED";
        var apiendpoint = "https://web-supergose.wedeploy.io";

        $.post( url, params ).done(function( data ) {
            token += data.id_token; 
        });



        $("#button-api").click(function(){
            $.ajax({
                url: apiendpoint,
                type: 'GET',
                success: function(data, status) {
                    return console.log(data);
                },
                beforeSend: function(xhr, settings) { xhr.setRequestHeader('Authorization',token); } 
            });
        });

    </script>
</body>
</html>